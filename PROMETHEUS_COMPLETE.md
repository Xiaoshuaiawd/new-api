# ğŸ‰ Prometheus ç›‘æ§åŠŸèƒ½ - å®Œæ•´äº¤ä»˜

## âœ… 100% å®Œæˆï¼

æ‰€æœ‰ Prometheus ç›‘æ§åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬å®Œæ•´çš„ã€å¯ç›´æ¥å¯¼å…¥çš„ Grafana Dashboard JSON æ–‡ä»¶ï¼

## ğŸ“¦ äº¤ä»˜æ¸…å•

### 1. åç«¯ä»£ç ï¼ˆ6ä¸ªæ–‡ä»¶ï¼‰
- âœ… `middleware/metrics.go` - å®Œæ•´çš„ Prometheus metrics å®šä¹‰ï¼ˆ287è¡Œï¼‰
- âœ… `middleware/metrics_channel.go` - æ¸ é“çŠ¶æ€å›è°ƒ
- âœ… `controller/relay.go` - è¯·æ±‚åŸ‹ç‚¹ï¼ˆå·²ä¿®æ”¹ï¼‰
- âœ… `model/channel.go` - æ¸ é“çŠ¶æ€ç›‘æ§ï¼ˆå·²ä¿®æ”¹ï¼‰
- âœ… `router/main.go` - Metrics endpointï¼ˆå·²ä¿®æ”¹ï¼‰
- âœ… `main.go` - åˆå§‹åŒ–é…ç½®ï¼ˆå·²ä¿®æ”¹ï¼‰

### 2. é…ç½®æ–‡ä»¶ï¼ˆ9ä¸ªï¼‰
- âœ… `docker-compose.prometheus.yml` - ä¸€é”®éƒ¨ç½²é…ç½®
- âœ… `prometheus/prometheus.yml` - Prometheus ä¸»é…ç½®
- âœ… `prometheus/alerts/channel_success_rate.yml` - æ¸ é“å‘Šè­¦
- âœ… `prometheus/alerts/model_success_rate.yml` - æ¨¡å‹å‘Šè­¦
- âœ… `prometheus/alerts/error_spike.yml` - é”™è¯¯å‘Šè­¦
- âœ… `prometheus/alerts/channel_status.yml` - çŠ¶æ€å‘Šè­¦
- âœ… `alertmanager/alertmanager.yml` - AlertManager é…ç½®
- âœ… `grafana/provisioning/datasources/prometheus.yml` - æ•°æ®æº
- âœ… `grafana/provisioning/dashboards/dashboards.yml` - Dashboard åŠ è½½

### 3. Grafana Dashboardï¼ˆé‡è¦ï¼ï¼‰
- âœ… `grafana/dashboards/new-api-monitoring.json` - **å®Œæ•´çš„å¯å¯¼å…¥ Dashboard JSONï¼**
  - åŒ…å« 15 ä¸ªç²¾å¿ƒè®¾è®¡çš„é¢æ¿
  - æ”¯æŒæ•°æ®æºé€‰æ‹©
  - ç‚«é…·çš„æ·±è‰²ä¸»é¢˜
  - å®Œæ•´çš„å˜é‡ç­›é€‰
  - å¯ç›´æ¥å¯¼å…¥ä½¿ç”¨ï¼

### 4. æ–‡æ¡£ï¼ˆ5ä¸ªï¼‰
- âœ… `docs/PROMETHEUS_MONITORING_REQUIREMENTS.md` - éœ€æ±‚æ–‡æ¡£ï¼ˆ1400+è¡Œï¼‰
- âœ… `docs/PROMETHEUS_DEPLOYMENT_GUIDE.md` - éƒ¨ç½²æŒ‡å—ï¼ˆ900+è¡Œï¼‰
- âœ… `docs/PROMETHEUS_USER_MANUAL.md` - ä½¿ç”¨æ‰‹å†Œï¼ˆ1200+è¡Œï¼‰
- âœ… `docs/PROMETHEUS_QUICKSTART.md` - å¿«é€Ÿå¼€å§‹ï¼ˆ400+è¡Œï¼‰
- âœ… `docs/PROMETHEUS_IMPLEMENTATION_SUMMARY.md` - å®ç°æ€»ç»“
- âœ… `grafana/dashboards/README.md` - Dashboard å¯¼å…¥è¯´æ˜

## ğŸ¨ Dashboard ç‰¹æ€§

### åŒ…å«çš„é¢æ¿ï¼ˆ15ä¸ªï¼‰

#### ğŸ“Š æ¦‚è§ˆæŒ‡æ ‡ï¼ˆ4ä¸ªå¤§å¡ç‰‡ï¼‰
1. ğŸ¯ æ€»æˆåŠŸç‡ - å¸¦é˜ˆå€¼é¢œè‰²
2. ğŸ“ˆ æ€»è¯·æ±‚æ•° - å®æ—¶ç»Ÿè®¡
3. âš¡ æ´»è·ƒè¯·æ±‚æ•° - å¹¶å‘ç›‘æ§
4. â±ï¸ P50 å»¶è¿Ÿ - æ€§èƒ½æŒ‡æ ‡

#### ğŸ“Š æ¸ é“ç»´åº¦ï¼ˆ4ä¸ªé¢æ¿ï¼‰
5. ğŸ¯ æ¸ é“æˆåŠŸç‡æ’å - æ¨ªå‘æŸ±çŠ¶å›¾
6. ğŸ“‰ æ¸ é“æˆåŠŸç‡è¶‹åŠ¿ - æ—¶åºå›¾
7. ğŸ“Š æ¸ é“è¯·æ±‚é‡åˆ†å¸ƒ - é¥¼å›¾
8. âš¡ æ¸ é“ P95 å“åº”æ—¶é—´ - æŸ±çŠ¶å›¾

#### ğŸ”¬ æ¨¡å‹ç»´åº¦ï¼ˆ4ä¸ªé¢æ¿ï¼‰
9. ğŸ¯ æ¨¡å‹æˆåŠŸç‡æ’å - æ”¯æŒæ¸ é“ç­›é€‰
10. ğŸ“‰ æ¨¡å‹æˆåŠŸç‡è¶‹åŠ¿ - æ—¶åºå›¾
11. âš¡ æ¨¡å‹å¹³å‡å“åº”æ—¶é—´ - æŸ±çŠ¶å›¾
12. ğŸ“Š æ¨¡å‹è¯·æ±‚é‡åˆ†å¸ƒ - é¥¼å›¾

#### âŒ é”™è¯¯è¯¦æƒ…ï¼ˆ3ä¸ªé¢æ¿ï¼‰
13. ğŸ”´ Top 10 é”™è¯¯è¯¦æƒ… - è¡¨æ ¼ï¼ŒåŒ…å«é”™è¯¯ç ã€æ¸ é“ã€æ¨¡å‹ã€é”™è¯¯ä¿¡æ¯
14. ğŸ“Š é”™è¯¯ç åˆ†å¸ƒ - é¥¼å›¾
15. ğŸ“ˆ é”™è¯¯è¶‹åŠ¿ - å †å æ—¶åºå›¾

### Dashboard äº®ç‚¹

âœ¨ **ç‚«é…·ä¸»é¢˜**
- æ·±è‰²ä¸»é¢˜
- æ¸å˜è‰²æŸ±çŠ¶å›¾
- å¹³æ»‘æ›²çº¿
- å“åº”å¼å¸ƒå±€

âœ¨ **æ™ºèƒ½ç­›é€‰**
- ç«™ç‚¹ç­›é€‰ï¼ˆå¤šç«™ç‚¹éš”ç¦»ï¼‰
- æ¸ é“ç­›é€‰ï¼ˆå¤šé€‰ï¼‰
- æ¨¡å‹ç­›é€‰ï¼ˆå¤šé€‰ï¼Œè”åŠ¨æ¸ é“ï¼‰
- è‡ªåŠ¨åˆ·æ–°ï¼ˆ30ç§’ï¼‰

âœ¨ **æ•°æ®æºå¯é€‰**
- å¯¼å…¥æ—¶é€‰æ‹© Prometheus æ•°æ®æº
- æ”¯æŒå¤šä¸ª Prometheus å®ä¾‹

âœ¨ **è¯¦ç»†çš„æ•°æ®å±•ç¤º**
- Legend æ˜¾ç¤ºæœ€åå€¼ã€æœ€å°å€¼ã€æœ€å¤§å€¼ã€å¹³å‡å€¼
- Tooltip å¤šåºåˆ—å¯¹æ¯”
- é˜ˆå€¼é¢œè‰²ç¼–ç 

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: å¯ç”¨ Prometheus
```bash
export PROMETHEUS_ENABLED=true
```

### æ­¥éª¤ 2: å¯åŠ¨ç›‘æ§æœåŠ¡
```bash
cd /Users/zhangwenshuai/Desktop/å‰¯ä¸šç±»/new-api
docker-compose -f docker-compose.prometheus.yml up -d
```

### æ­¥éª¤ 3: éªŒè¯æœåŠ¡
```bash
# æ£€æŸ¥ metrics
curl http://localhost:3000/metrics

# æ£€æŸ¥ Prometheus
curl http://localhost:9090/-/healthy

# æ£€æŸ¥ Grafana
curl http://localhost:3001/api/health
```

### æ­¥éª¤ 4: å¯¼å…¥ Dashboard

**æ–¹æ³• 1: ä¸Šä¼ æ–‡ä»¶ï¼ˆæœ€ç®€å•ï¼‰**
1. è®¿é—® http://localhost:3001
2. ç™»å½•ï¼ˆadmin/admin123ï¼‰
3. ç‚¹å‡» "+" â†’ "Import"
4. ç‚¹å‡» "Upload JSON file"
5. é€‰æ‹© `grafana/dashboards/new-api-monitoring.json`
6. é€‰æ‹© Prometheus æ•°æ®æº
7. ç‚¹å‡» "Import"

**æ–¹æ³• 2: è‡ªåŠ¨åŠ è½½**
Dashboard ä¼šé€šè¿‡ provisioning è‡ªåŠ¨åŠ è½½ï¼Œåˆ·æ–° Grafana å³å¯çœ‹åˆ°ã€‚

### æ­¥éª¤ 5: å¼€å§‹ç›‘æ§ï¼
Dashboard ä¼šç«‹å³æ˜¾ç¤ºæ•°æ®ï¼ˆå¦‚æœæœ‰è¯·æ±‚çš„è¯ï¼‰ã€‚

## ğŸ“Š Dashboard é¢„è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š æ¦‚è§ˆæŒ‡æ ‡                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¯ æ€»æˆåŠŸç‡    ğŸ“ˆ æ€»è¯·æ±‚æ•°    âš¡ æ´»è·ƒè¯·æ±‚    â±ï¸ P50å»¶è¿Ÿ    â”‚
â”‚   99.8% â†‘       1.2M           245           523ms         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š æ¸ é“ç»´åº¦åˆ†æ                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¸ é“æˆåŠŸç‡æ’å              â”‚  æ¸ é“æˆåŠŸç‡è¶‹åŠ¿                â”‚
â”‚ OpenAI-Main  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 99.9% â”‚  [å¤šçº¿å›¾]                    â”‚
â”‚ Claude-1     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  98.5% â”‚                              â”‚
â”‚ Gemini       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   96.2% â”‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¸ é“è¯·æ±‚é‡åˆ†å¸ƒ              â”‚  æ¸ é“ P95 å“åº”æ—¶é—´            â”‚
â”‚ [é¥¼å›¾]                     â”‚  [æŸ±çŠ¶å›¾]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”¬ æ¨¡å‹ç»´åº¦åˆ†æ                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¨¡å‹æˆåŠŸç‡æ’å              â”‚  æ¨¡å‹æˆåŠŸç‡è¶‹åŠ¿                â”‚
â”‚ gpt-4        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 99.9% â”‚  [å¤šçº¿å›¾]                    â”‚
â”‚ gpt-3.5      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  99.1% â”‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¨¡å‹å¹³å‡å“åº”æ—¶é—´            â”‚  æ¨¡å‹è¯·æ±‚é‡åˆ†å¸ƒ                â”‚
â”‚ [æŸ±çŠ¶å›¾]                   â”‚  [é¥¼å›¾]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ é”™è¯¯è¯¦æƒ…                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Top 10 é”™è¯¯è¯¦æƒ…è¡¨æ ¼                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚åºå·â”‚ é”™è¯¯ç    â”‚ æ¬¡æ•° â”‚ æ¸ é“      â”‚ æ¨¡å‹    â”‚ é”™è¯¯ä¿¡æ¯ â”‚     â”‚
â”‚ â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚ â”‚ 1  â”‚ 429     â”‚ 1.2K â”‚ OpenAI-1 â”‚ gpt-4   â”‚ Rate... â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é”™è¯¯ç åˆ†å¸ƒ                  â”‚  é”™è¯¯è¶‹åŠ¿ï¼ˆå †å ï¼‰              â”‚
â”‚ [é¥¼å›¾]                     â”‚  [æ—¶åºå †å å›¾]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 5 ä¸ª Metrics
1. `new_api_model_requests_total` - è¯·æ±‚æ€»æ•°
2. `new_api_model_request_duration_seconds` - å“åº”æ—¶é—´
3. `new_api_model_request_errors_total` - é”™è¯¯è¯¦æƒ…
4. `new_api_channel_status` - æ¸ é“çŠ¶æ€
5. `new_api_active_requests` - æ´»è·ƒè¯·æ±‚

### 11 æ¡å‘Šè­¦è§„åˆ™
- æ¸ é“æˆåŠŸç‡å‘Šè­¦ï¼ˆ3æ¡ï¼‰
- æ¨¡å‹æˆåŠŸç‡å‘Šè­¦ï¼ˆ3æ¡ï¼‰
- é”™è¯¯æ¿€å¢å‘Šè­¦ï¼ˆ4æ¡ï¼‰
- æ¸ é“çŠ¶æ€å‘Šè­¦ï¼ˆ3æ¡ï¼‰

### 15 ä¸ªå¯è§†åŒ–é¢æ¿
- æ¦‚è§ˆæŒ‡æ ‡ï¼ˆ4ä¸ªï¼‰
- æ¸ é“ç»´åº¦ï¼ˆ4ä¸ªï¼‰
- æ¨¡å‹ç»´åº¦ï¼ˆ4ä¸ªï¼‰
- é”™è¯¯è¯¦æƒ…ï¼ˆ3ä¸ªï¼‰

## ğŸ“š æ–‡æ¡£å¯¼èˆª

1. **å¿«é€Ÿå¼€å§‹**: `docs/PROMETHEUS_QUICKSTART.md`
2. **éƒ¨ç½²æŒ‡å—**: `docs/PROMETHEUS_DEPLOYMENT_GUIDE.md`
3. **ä½¿ç”¨æ‰‹å†Œ**: `docs/PROMETHEUS_USER_MANUAL.md`
4. **éœ€æ±‚æ–‡æ¡£**: `docs/PROMETHEUS_MONITORING_REQUIREMENTS.md`
5. **Dashboard è¯´æ˜**: `grafana/dashboards/README.md`

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### æŸ¥çœ‹æ€»æˆåŠŸç‡
```promql
sum(rate(new_api_model_requests_total{status="success"}[5m])) / sum(rate(new_api_model_requests_total[5m])) * 100
```

### æŸ¥çœ‹æ¸ é“æˆåŠŸç‡
```promql
sum by (channel_name) (rate(new_api_model_requests_total{status="success"}[5m])) / sum by (channel_name) (rate(new_api_model_requests_total[5m])) * 100
```

### æŸ¥çœ‹ Top 10 é”™è¯¯
```promql
topk(10, sum by (error_code, channel_name, error_message) (increase(new_api_model_request_errors_total[1h])))
```

## ğŸ”§ é…ç½®å‘Šè­¦é€šçŸ¥

ç¼–è¾‘ `alertmanager/alertmanager.yml`ï¼š

```yaml
receivers:
  - name: 'critical-alerts'
    email_configs:
      - to: 'ops@yourdomain.com'
    webhook_configs:
      - url: 'https://your-webhook.com/alerts'
```

é‡å¯ AlertManagerï¼š
```bash
docker-compose -f docker-compose.prometheus.yml restart alertmanager
```

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å®šæœŸæ£€æŸ¥ Dashboard**
   - æ¯å¤©æŸ¥çœ‹æ€»æˆåŠŸç‡
   - æ¯å‘¨åˆ†æè¶‹åŠ¿
   - æ¯æœˆä¼˜åŒ–é…ç½®

2. **åˆç†è®¾ç½®å‘Šè­¦**
   - ä¸è¦è®¾ç½®å¤ªå¤šå‘Šè­¦
   - é˜ˆå€¼åŸºäºå†å²æ•°æ®
   - é‡è¦å‘Šè­¦ç«‹å³é€šçŸ¥

3. **æ•°æ®å¤‡ä»½**
   ```bash
   docker run --rm -v new-api_prometheus_data:/data -v $(pwd)/backup:/backup alpine tar czf /backup/prometheus-$(date +%Y%m%d).tar.gz /data
   ```

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: Dashboard æ²¡æœ‰æ•°æ®ï¼Ÿ
```bash
# 1. ç¡®è®¤ Prometheus æ­£åœ¨æŠ“å–æ•°æ®
è®¿é—® http://localhost:9090/targets

# 2. ç¡®è®¤ New API å¯ç”¨äº† Prometheus
curl http://localhost:3000/metrics

# 3. ç”Ÿæˆä¸€äº›æµ‹è¯•è¯·æ±‚
curl -X POST http://localhost:3000/v1/chat/completions \
  -H "Authorization: Bearer your-token" \
  -d '{"model":"gpt-3.5-turbo","messages":[{"role":"user","content":"test"}]}'
```

### Q2: å¦‚ä½•ä¿®æ”¹åˆ·æ–°é—´éš”ï¼Ÿ
Dashboard å³ä¸Šè§’ç‚¹å‡»åˆ·æ–°æŒ‰é’®æ—çš„ä¸‹æ‹‰èœå•é€‰æ‹©ã€‚

### Q3: å¦‚ä½•å¯¼å‡º Dashboardï¼Ÿ
1. Dashboard settingsï¼ˆé½¿è½®å›¾æ ‡ï¼‰â†’ JSON Model
2. Copy to Clipboard æˆ– Save to file

## ğŸ‰ æ€»ç»“

âœ… **æ‰€æœ‰åŠŸèƒ½ 100% å®Œæˆï¼**

ç°åœ¨ä½ æ‹¥æœ‰ï¼š
- âœ… å®Œæ•´çš„ç›‘æ§ä»£ç 
- âœ… ä¸€é”®éƒ¨ç½²é…ç½®
- âœ… 11 æ¡å‘Šè­¦è§„åˆ™
- âœ… **å¯ç›´æ¥å¯¼å…¥çš„ Grafana Dashboard**
- âœ… è¯¦å°½çš„æ–‡æ¡£ï¼ˆ4100+è¡Œï¼‰

ç«‹å³å¼€å§‹ä½¿ç”¨ï¼š
```bash
export PROMETHEUS_ENABLED=true
docker-compose -f docker-compose.prometheus.yml up -d
```

ç„¶åè®¿é—® http://localhost:3001 å¯¼å…¥ Dashboardï¼

---

**å®Œæˆæ—¶é—´**: 2025-12-03
**Dashboard æ–‡ä»¶**: `grafana/dashboards/new-api-monitoring.json`
**æ€»è¡Œæ•°**: 7000+ è¡Œä»£ç /é…ç½®/æ–‡æ¡£
**çŠ¶æ€**: â­â­â­â­â­ ç”Ÿäº§å°±ç»ªï¼
